---
title: "ESM 204 Assignment 4"
author: "Sam Rozal, Deanna Elliot, Claire Meuter"
date: "5/16/2022"
output: 
  html_document:
    code_folding: hide
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(janitor)
library(here)
```


```{r}
#read in the data 
warming <- read_csv(here("data","warming.csv")) 

damages <- read_csv(here("data","damages.csv"))
```

## Question 1 

```{r}
#create a model for climate change
climate_change_damages <- lm (damages ~ warming + I(warming^2) - 1, data=damages)

#get the coefficients from the model, so later on we can write a function with the coefficients for predicting stuff later
sum_ccd <- summary(climate_change_damages)

#get predicted values 
damages_predicted <- climate_change_damages$fitted.values
```

**The equation of our quadratic damage function is Damages = -1.06e12(Warming)+ 1.941e13(Warming^2).**

```{r}
#write a function to display this equation

damage_function <- function(warming)
  {dam <- (climate_change_damages$coefficients[1]* (warming)) +
    (climate_change_damages$coefficients[2] * (warming^2))
  return(dam)}
```

### Damages from Increased Global Mean Temperature

```{r}
ggplot(data=climate_change_damages, aes(x=warming,y=damages))+
  geom_point(aes(x=warming,y=damages), shape = 21, color = "darkgrey", fill = "grey")+
  geom_line(aes(x=warming,y=damages_predicted), size = 1.15, color = "royalblue")+
  labs(x="Warming (Celsius)", y="Damages (USD)")+
  theme_minimal()+
  theme(plot.background = element_rect(fill="azure2")) +
  theme(panel.background = element_rect(fill="aliceblue"))+
  theme(legend.background= element_rect(fill= "azure1"))
```


## Question 2

```{r}
#create a new tibble to get the values of predicted baseline
baseline = tibble(warming = warming$warming_baseline)
predicted_baseline = predict(climate_change_damages, newdata= baseline)
```

```{r}
#use the written function to get the values for the dmage at the baseline 
damages_baseline_df <- warming %>%
  mutate(baseline_damages = damage_function(warming_baseline))
```

### Plot 1: Damages Over Time Without CO2 Pulse

```{r}
#graph it 

ggplot(data=damages_baseline_df, aes(x=year, y=baseline_damages))+
  geom_line(size=1.3, color = "royalblue")+
  labs(x="Year", y ="Damages (USD)")+
  theme_minimal()+
  theme(plot.background = element_rect(fill="azure2")) +
  theme(panel.background = element_rect(fill="aliceblue"))+
  theme(legend.background= element_rect(fill= "azure1"))
```

### Plot 2: Damages Over Time With CO2 Pulse (35 tons)

```{r}
#create a new data frame with damages with damages with and without pulse
damages_baseline_pulse_df <- warming %>%
  mutate(baseline_damages = damage_function(warming_baseline))%>%
  mutate(pulse_damages = damage_function(warming_pulse))
```

```{r}
ggplot(data=damages_baseline_pulse_df)+
  geom_line(aes(x=year, y=pulse_damages), size = 1.3, color = "royalblue")+
  labs(x="Year", y ="Damages (USD)")+
  theme_minimal()+
  theme(plot.background = element_rect(fill="azure2")) +
  theme(panel.background = element_rect(fill="aliceblue"))+
  theme(legend.background= element_rect(fill= "azure1"))
```

### Plot 3: Difference in Damages Over Time (From Pulse)

```{r}
#create a new data frame with damages with damages with pulse, without pulse, and difference in damages
damages_baseline_pulse_diff_df <- warming %>%
  mutate(baseline_damages = damage_function(warming_baseline))%>%
  mutate(pulse_damages = damage_function(warming_pulse)) %>% 
  mutate(diff_damages = (pulse_damages-baseline_damages))
```

```{r}
ggplot(data=damages_baseline_pulse_diff_df)+
  geom_line(aes(x=year, y=diff_damages), size = 1.3, color = "royalblue")+
  labs(x="Year", y ="Damages(USD)")+
  theme_minimal()+
  theme(plot.background = element_rect(fill="azure2")) +
  theme(panel.background = element_rect(fill="aliceblue"))+
  theme(legend.background= element_rect(fill= "azure1"))
```

### Plot 4: Difference in Damages Over Time (From Pulse) Per Ton of CO2

```{r}
#create a new data frame with damages with damages with pulse, without pulse, difference in damages, and differnce in damages per ton Co2
damages_baseline_pulse_diff_perton_df <- warming %>%
  mutate(baseline_damages = damage_function(warming_baseline))%>%
  mutate(pulse_damages = damage_function(warming_pulse)) %>% 
  mutate(diff_damages = (pulse_damages-baseline_damages)) %>% 
  mutate(diff_damages_perton = (diff_damages/35000000000))
```

```{r}
ggplot(data=damages_baseline_pulse_diff_perton_df)+
  geom_line(aes(x=year, y=diff_damages_perton), size = 1.3, color = "royalblue")+
  labs(x="Year", y ="Damages(USD)")+
  theme_minimal()+
  theme(plot.background = element_rect(fill="azure2")) +
  theme(panel.background = element_rect(fill="aliceblue"))+
  theme(legend.background= element_rect(fill= "azure1"))
```

# Question 3
3. The SCC is the present discounted value of the stream of future damages caused by one additional ton of CO2. The Obama Administration used a discount rate of 3% to discount damages. Recently, New York State used a discount rate of 2%. Calculate and make a plot of the SCC (y-axis) against the discount rate (x-axis) for a reasonable range of discount rates. Explain the intuition for how the discount rate affects the SCC.

Note: The equation to calculate present value is PV= B/((1+r^t))

 Explain the intuition for how the discount rate affects the SCC.
If you lower the discount rate
social cost of carbon dependent on 




- We assume that a reasonable range of discount rates is 1%-10%. This is because 

```{r}
# Set the pulse year to 2022
pulse_year <- 2022

discount_rates<- damages_baseline_pulse_diff_perton_df %>% 
  mutate(discount_rate_1_percent = diff_damages_perton / ((1.01)^(year-pulse_year))) %>% 
  mutate(discount_rate_2_percent = diff_damages_perton / ((1.02)^(year-pulse_year))) %>% 
  mutate(discount_rate_3_percent = diff_damages_perton / ((1.03)^(year-pulse_year))) %>% 
  mutate(discount_rate_4_percent = diff_damages_perton / ((1.04)^(year-pulse_year))) %>% 
  mutate(discount_rate_5_percent = diff_damages_perton / ((1.05)^(year-pulse_year))) %>% 
  mutate(discount_rate_6_percent = diff_damages_perton / ((1.06)^(year-pulse_year))) %>% 
  mutate(discount_rate_7_percent = diff_damages_perton / ((1.07)^(year-pulse_year))) %>% 
  mutate(discount_rate_8_percent = diff_damages_perton / ((1.08)^(year-pulse_year))) %>% 
  mutate(discount_rate_9_percent = diff_damages_perton / ((1.09)^(year-pulse_year))) %>% 
  mutate(discount_rate_10_percent = diff_damages_perton / ((1.1)^(year-pulse_year))) 

discount_rates_simplified <- discount_rates %>% 
  select(year,discount_rate_1_percent,discount_rate_2_percent,discount_rate_3_percent,discount_rate_4_percent,discount_rate_5_percent,discount_rate_6_percent,discount_rate_7_percent,discount_rate_8_percent,discount_rate_9_percent,discount_rate_10_percent)
```

```{r}
#create a vector with the different present values
present_values <- c(sum(discount_rates_simplified$discount_rate_1_percent),
                    sum(discount_rates_simplified$discount_rate_2_percent),
                    sum(discount_rates_simplified$discount_rate_3_percent),
                    sum(discount_rates_simplified$discount_rate_4_percent),
                    sum(discount_rates_simplified$discount_rate_5_percent),
                    sum(discount_rates_simplified$discount_rate_6_percent),
                    sum(discount_rates_simplified$discount_rate_7_percent),
                    sum(discount_rates_simplified$discount_rate_8_percent),
                    sum(discount_rates_simplified$discount_rate_9_percent),
                    sum(discount_rates_simplified$discount_rate_10_percent))

#make it into a data frame
social_cost_df <- data.frame(present_values)

#create a vector of the different discount rates
discount_rate <- c(0.01,0.02,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.1)

#make it into a data frame
discount_rate_df <- data.frame(discount_rate) 

#make a data frame with both discount rates and present values
scc_and_discount_df <- data.frame(present_values,discount_rate)

```

### Social Cost of Carbon at Different Discount Rates

```{r}
#create a graph with the discount rates and present values 

ggplot(data=scc_and_discount_df, aes(x=discount_rate, y=present_values))+
  geom_line(size = 1.3, color = "royalblue")+
  labs(y="Social Cost of Carbon (Present Value)", x= "Discount Rate")+
  theme_minimal()+
  theme(plot.background = element_rect(fill="azure2")) +
  theme(panel.background = element_rect(fill="aliceblue"))+
  theme(legend.background= element_rect(fill= "azure1"))

```

# Question 4
The National Academies of Sciences, Engineering, and Medicine advised the government in a 2017 report to use the Ramsey Rule when discounting within the SCC calculation:

r = ρ + ηg
Using ρ = 0.001, η = 2, and g = 0.01, what is the SCC? Locate this point on your graph from above.

```{r}
#Write a function for ramsey rule

ramsey_rule <- function(p,n,g){
  r <- p + (n*g)
  return(r)
}
```

```{r}
#find new r value using given values 
new_r <- ramsey_rule(0.001,2,0.01)
new_r
```

```{r}
#use the present value stuff we did earlier so that we can find the new present value with the r value found underneath our Ramsey rule 
ramsey_rule_pv <- damages_baseline_pulse_diff_perton_df %>% 
  mutate(discount_rate_ramsey = diff_damages_perton / ((1+new_r)^(year-pulse_year)))
```

```{r}
# Find the total present value, by summing up the column of the Ramsey rate

ramsey_total_pv <- sum(ramsey_rule_pv$discount_rate_ramsey)

```

```{r}
# Now I need to plot where the present value is on the graph. To do this, we need to create a data frame with it on there, so I can graph it
ramsey_rule_df <- data.frame(new_r,ramsey_total_pv)
```

### Social Cost of Carbon Using Ramsey Rule

```{r}
#Plot it 
ggplot()+
  geom_line(data=scc_and_discount_df, aes(x=discount_rate, y=present_values), color = "royalblue", size = 1.3)+
  geom_point(data=ramsey_rule_df, aes(x=new_r, y=ramsey_total_pv), size = 4, color = "black")+
  labs(y="Social Cost of Carbon (Present Value)", x= "Discount Rate")+
  theme_minimal()+
  theme(legend.position = "none") +
  theme(plot.background = element_rect(fill="azure2")) +
  theme(panel.background = element_rect(fill="aliceblue"))+
  theme(legend.background= element_rect(fill= "azure1"))

```

**Using ρ = 0.001, η = 2, and g = 0.01, the SCC is $71.35, as seen in the graph above.**

## Question 5
Now suppose there are two possible climate policies that can be pursued. Policy A is business as usual and Policy B is to take immediate and strong action on climate change. Use these facts

- If you undertake Policy A there are two possible outcomes. Either warming will occur as in the “baseline” (i.e. “no-pulse”) dataset above (this happens with probability 0.5) or warming each year will be 1.5 times that in the “baseline” dataset (with probability 0.5)

- Under Policy B, warming will continue until 2050 as in the “baseline” dataset, and then will stabilize at 1.29 degrees and stay that way forever.

-Society is risk neutral

-Use a discount rate of 2%

- What is the expected present value of damages up to 2100 under Policy A? What is the expected present value of damages up to 2100 under Policy B? Suppose undertaking Policy A costs zero and undertaking Policy B costs X. The total cost of a policy is the implementation cost plus expected damages. Make a plot of total cost of Policy A and total cost of Policy against X. Suppose Congress wants to undertake the policy with the lower total cost. Use your graph to advise Congress

First, we create the data set of damages under a warming scenario that is 1.5 times that of the baseline warming.

```{r}
#Calculate the damages under the 1.5 scenario
warming_damages_1.5 <- warming %>%
  mutate(damages_1.5 = (damage_function(warming_baseline*1.5))) 

warming_damages_1.5_pv <- warming_damages_1.5 %>% 
  mutate(pv_damages_1.5 = damages_1.5 / ((1.02)^(year-pulse_year)))

#make a data frame with both the baseline and line present values in it
warming_damages_policyA <- warming %>%
  mutate(damages_base = (damage_function(warming_baseline)))%>% 
  mutate(pv_damages_base = (damages_base) / ((1.02)^(year-pulse_year)))%>% 
  mutate(damages_1.5 = (damage_function(warming_baseline*1.5))) %>% 
  mutate(pv_damages_1.5 = (damages_1.5) / ((1.02)^(year-pulse_year)))
```

```{r}
#now I need to sum up the present values to get the total present values for each of the scenarios
total_pv_base_scenraio_a <- (sum(warming_damages_policyA$pv_damages_base))
total_pv_1.5_scenraio_a <- (sum(warming_damages_policyA$pv_damages_1.5))
```

Given that we know that the probability of each scenarios is 1/2 and that the utility function is linear, to find the expected present value we just need to take the average of the two expected total present values

```{r}
net_present_value_scenarioA <- (0.5*total_pv_base_scenraio_a)+ (0.5*total_pv_1.5_scenraio_a)

```
The present value of the damages up to 2100 is `r net_present_value_scenarioA`

Next, we find the net present value of Scenario B 
```{r}
warming_damages_policyB <- warming %>%
  select(year,warming_baseline) %>% 
  mutate(damages_policyB = case_when(
    year > 2050 ~ 1.29,
    TRUE ~ warming_baseline)) %>% 
  mutate(damage_policyB_b4_2050 = damage_function(damages_policyB)) %>% 
  mutate(damages_policyB_pv = damage_policyB_b4_2050/((1.02)^(year-pulse_year)))

```


```{r}

```


